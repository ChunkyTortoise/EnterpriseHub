databases:
  - name: jorge-realty-db
    databaseName: jorge_realty
    user: jorge_realty
    plan: starter  # $7/mo — free tier expires after 90 days
    region: oregon
    postgresMajorVersion: 15

  - name: jorge-realty-redis
    plan: starter  # $10/mo — free tier spins down
    region: oregon
    # Render injects REDIS_URL automatically

services:
  - type: web
    name: jorge-realty-ai
    env: python
    region: oregon
    plan: starter  # $7/mo — free tier spins down after 15 min (bots won't respond)
    branch: main
    rootDir: ghl_real_estate_ai
    buildCommand: pip install -r requirements-prod.txt
    startCommand: PYTHONPATH=.. uvicorn api.main_prod:app --host 0.0.0.0 --port $PORT --workers 1
    healthCheckPath: /api/health/live
    envVars:
      # Runtime
      - key: PYTHON_VERSION
        value: "3.11"
      - key: ENVIRONMENT
        value: production
      - key: DEBUG_MODE
        value: "false"
      - key: LOG_LEVEL
        value: INFO
      - key: PORT
        value: "8000"

      # Database — Render injects these automatically from the databases above
      - key: DATABASE_URL
        fromDatabase:
          name: jorge-realty-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          name: jorge-realty-redis
          type: redis
          property: connectionString

      # -----------------------------------------------------------------------
      # SECRETS — set these manually in the Render dashboard
      # Dashboard → jorge-realty-ai → Environment → Add Environment Variable
      # -----------------------------------------------------------------------
      - key: ANTHROPIC_API_KEY
        sync: false   # Jorge provides this on the Zoom call
      - key: GHL_API_KEY
        sync: false
      - key: GHL_LOCATION_ID
        sync: false
      - key: LOCATION_ID
        sync: false
      - key: GHL_WEBHOOK_SECRET
        sync: false
      - key: JWT_SECRET_KEY
        sync: false

      # Bot activation — matches GHL workflow trigger tag
      - key: ACTIVATION_TAGS
        value: '["needs qualifying", "Needs Qualifying", "ai on", "AI On"]'

      # -----------------------------------------------------------------------
      # JORGE BOT CONFIG — set in dashboard with values from .env.jorge
      # -----------------------------------------------------------------------

      # Bot mode flags
      - key: JORGE_SELLER_MODE
        value: "true"
      - key: JORGE_BUYER_MODE
        value: "true"
      - key: JORGE_LEAD_MODE
        value: "true"

      # Tag routing — MUST be distinct from seller/buyer activation tags
      # Seller fires on "Needs Qualifying" | Buyer fires on BUYER_LEAD_TAG
      # Lead fires on LEAD_ACTIVATION_TAG — use a dedicated tag so there's no collision
      - key: LEAD_ACTIVATION_TAG
        value: "Needs Qualifying"
      - key: BUYER_LEAD_TAG
        value: "Buyer-Lead"
      - key: JORGE_SIMPLE_MODE
        value: "true"
      - key: FRIENDLY_APPROACH
        value: "true"
      - key: USE_WARM_LANGUAGE
        value: "true"
      - key: NO_HYPHENS
        value: "true"
      - key: MAX_SMS_LENGTH
        value: "320"
      - key: JORGE_MARKET
        value: "rancho_cucamonga"
      - key: JORGE_ANALYTICS_ENABLED
        value: "true"

      # GHL Calendar (set in dashboard once you have the ID)
      - key: JORGE_CALENDAR_ID
        sync: false
      - key: GHL_CALENDAR_ID
        sync: false
      - key: JORGE_USER_ID
        sync: false   # Jorge's GHL User ID — needed for appointment assignment
      - key: JORGE_DIGEST_EMAIL
        sync: false   # Email for daily 7am performance digest

      # GHL Workflow IDs (already created — see ZOOM checklist for values)
      - key: HOT_SELLER_WORKFLOW_ID
        sync: false
      - key: WARM_SELLER_WORKFLOW_ID
        sync: false
      - key: HOT_BUYER_WORKFLOW_ID
        sync: false
      - key: WARM_BUYER_WORKFLOW_ID
        sync: false
      - key: NOTIFY_AGENT_WORKFLOW_ID
        sync: false

      # GHL Custom Field IDs (set in dashboard — run jorge_ghl_setup to get IDs)
      - key: CUSTOM_FIELD_LEAD_SCORE
        sync: false
      - key: CUSTOM_FIELD_BUDGET
        sync: false
      - key: CUSTOM_FIELD_LOCATION
        sync: false
      - key: CUSTOM_FIELD_TIMELINE
        sync: false
      - key: CUSTOM_FIELD_SELLER_TEMPERATURE
        sync: false
      - key: CUSTOM_FIELD_SELLER_MOTIVATION
        sync: false
      - key: CUSTOM_FIELD_TIMELINE_URGENCY
        sync: false
      - key: CUSTOM_FIELD_PROPERTY_CONDITION
        sync: false
      - key: CUSTOM_FIELD_PRICE_EXPECTATION
        sync: false
      - key: CUSTOM_FIELD_BUYER_TEMPERATURE
        sync: false
      - key: CUSTOM_FIELD_PRE_APPROVAL_STATUS
        sync: false
      - key: CUSTOM_FIELD_PROPERTY_PREFERENCES
        sync: false
      - key: CUSTOM_FIELD_QUESTIONS_ANSWERED
        sync: false
      - key: CUSTOM_FIELD_QUALIFICATION_SCORE
        sync: false
      - key: CUSTOM_FIELD_QUALIFICATION_COMPLETE
        sync: false
      - key: CUSTOM_FIELD_PROPERTY_ADDRESS
        sync: false
      - key: CUSTOM_FIELD_PROPERTY_TYPE
        sync: false
      - key: CUSTOM_FIELD_LAST_BOT_INTERACTION
        sync: false

      # Jorge handoff custom fields
      - key: GHL_CUSTOM_FIELD_FRS
        sync: false
      - key: GHL_CUSTOM_FIELD_PCS
        sync: false
      - key: GHL_CUSTOM_FIELD_BUYER_INTENT
        sync: false
      - key: GHL_CUSTOM_FIELD_SELLER_INTENT
        sync: false
      - key: GHL_CUSTOM_FIELD_TEMPERATURE
        sync: false
      - key: GHL_CUSTOM_FIELD_HANDOFF_HISTORY
        sync: false
      - key: GHL_CUSTOM_FIELD_LAST_BOT
        sync: false
      - key: GHL_CUSTOM_FIELD_CONVERSATION_CONTEXT
        sync: false

      # Performance & alerting
      - key: PERFORMANCE_TRACKING_ENABLED
        value: "true"
      - key: ALERTING_ENABLED
        value: "true"
      - key: BOT_METRICS_ENABLED
        value: "true"

      # Appointment defaults
      - key: APPOINTMENT_TIMEZONE
        value: "America/Los_Angeles"
      - key: APPOINTMENT_DEFAULT_DURATION
        value: "60"
      - key: APPOINTMENT_BUFFER_MINUTES
        value: "15"
      - key: APPOINTMENT_MAX_DAYS_AHEAD
        value: "14"
      - key: APPOINTMENT_AUTO_BOOKING_ENABLED
        value: "true"
