apiVersion: v1
kind: Service
metadata:
  name: revenue-intelligence-service
  namespace: jorge-phase7
  labels:
    app: revenue-intelligence
    phase: "7"
spec:
  type: ClusterIP
  ports:
  - port: 8000
    targetPort: 8000
    name: http
  - port: 9090
    targetPort: 9090
    name: metrics
  selector:
    app: revenue-intelligence

---
apiVersion: v1
kind: Service
metadata:
  name: business-intelligence-service
  namespace: jorge-phase7
  labels:
    app: business-intelligence
    phase: "7"
spec:
  type: ClusterIP
  ports:
  - port: 8001
    targetPort: 8001
    name: http
  - port: 9091
    targetPort: 9091
    name: metrics
  selector:
    app: business-intelligence

---
apiVersion: v1
kind: Service
metadata:
  name: conversation-analytics-service
  namespace: jorge-phase7
  labels:
    app: conversation-analytics
    phase: "7"
spec:
  type: ClusterIP
  ports:
  - port: 8002
    targetPort: 8002
    name: http
  - port: 9092
    targetPort: 9092
    name: metrics
  selector:
    app: conversation-analytics

---
apiVersion: v1
kind: Service
metadata:
  name: market-intelligence-service
  namespace: jorge-phase7
  labels:
    app: market-intelligence
    phase: "7"
spec:
  type: ClusterIP
  ports:
  - port: 8003
    targetPort: 8003
    name: http
  - port: 9093
    targetPort: 9093
    name: metrics
  selector:
    app: market-intelligence

---
apiVersion: v1
kind: Service
metadata:
  name: stream-processor-service
  namespace: jorge-phase7
  labels:
    app: stream-processor
    phase: "7"
spec:
  type: ClusterIP
  ports:
  - port: 8004
    targetPort: 8004
    name: http
  - port: 8080
    targetPort: 8080
    name: websocket
  - port: 9094
    targetPort: 9094
    name: metrics
  selector:
    app: stream-processor

---
apiVersion: v1
kind: Service
metadata:
  name: cache-service-service
  namespace: jorge-phase7
  labels:
    app: cache-service
    phase: "7"
spec:
  type: ClusterIP
  ports:
  - port: 8005
    targetPort: 8005
    name: http
  - port: 9095
    targetPort: 9095
    name: metrics
  selector:
    app: cache-service

---
# LoadBalancer service for external access to Phase 7 services
apiVersion: v1
kind: Service
metadata:
  name: phase7-gateway
  namespace: jorge-phase7
  labels:
    app: phase7-gateway
    component: external-access
  annotations:
    service.beta.kubernetes.io/aws-load-balancer-type: nlb
    service.beta.kubernetes.io/aws-load-balancer-scheme: internet-facing
    service.beta.kubernetes.io/aws-load-balancer-ssl-cert: arn:aws:acm:us-east-1:ACCOUNT-ID:certificate/CERT-ID
    service.beta.kubernetes.io/aws-load-balancer-ssl-ports: "443"
    service.beta.kubernetes.io/aws-load-balancer-backend-protocol: http
spec:
  type: LoadBalancer
  ports:
  - port: 80
    targetPort: 8080
    name: http
  - port: 443
    targetPort: 8080
    name: https
  - port: 8080
    targetPort: 8080
    name: websocket
  selector:
    app: phase7-nginx-ingress

---
# Internal service mesh communication
apiVersion: v1
kind: Service
metadata:
  name: phase7-internal-mesh
  namespace: jorge-phase7
  labels:
    app: phase7-mesh
    component: service-mesh
spec:
  type: ClusterIP
  clusterIP: None
  ports:
  - port: 15001
    targetPort: 15001
    name: mesh-admin
  - port: 15000
    targetPort: 15000
    name: mesh-envoy
  selector:
    app: phase7-mesh